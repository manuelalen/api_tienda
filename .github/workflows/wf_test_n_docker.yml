name: CI con Poetry y Docker

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-poetry:
    name: ✨ Instalar y comprobar dependencias con Poetry
    runs-on: ubuntu-latest

    steps:
      - name: 📆 Checkout del repo
        uses: actions/checkout@v3

      - name: 🖊️ Instalar Poetry
        uses: abatilo/actions-poetry@v2

      - name: ⚖️ Instalar dependencias
        run: poetry install

      - name: ✅ Comprobación de sintaxis
        run: |
          poetry run python -m py_compile app_clientes.py app_caja.py main.py leer_delta_table.py

  build-docker:
    name: 🚧 Build de Docker si pasa Poetry
    runs-on: ubuntu-latest
    needs: test-poetry

    steps:
      - name: 📆 Checkout del repo
        uses: actions/checkout@v3

      - name: 📄 Construir imagen Docker
        run: docker build -t tienda_api .
